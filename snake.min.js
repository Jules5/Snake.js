!function(e){function t(e,t){this.x=0|e,this.y=0|t}var n=32,a=38,i=37,s=39,o=40,r=[a,i,o,s],f=[o,s,a,i],c=82,d={width:900,height:450,cols:45,rows:23,snake_size:5,diff:1,warp:!0,state:"pause",rand_bg:!1};t.prototype.equals=function(e){return this.x==e.x&&this.y==e.y?!0:!1},e.fn.snake=function(u){var l=e.extend(d,u);return this.each(function(){function d(){I=0,g(0),S=[],T=[],D=s,N.x=parseInt(_/2),N.y=parseInt(z/2),A!=l.state&&C(),e(".player",H).empty(),x(l.snake_size);for(var t=1;I>t;++t)S[t].x-=t;e(".piece-0",H).addClass("head right").css("z-index","1"),u(),w(),"undefined"!=typeof q&&clearInterval(q),q=setInterval(function(){b()},F)}function u(){do Q.x=Math.floor(Math.random()*_),Q.y=Math.floor(Math.random()*z);while(N.equals(Q));e(".fruit",H).css({marginLeft:Q.x*O+"px",marginTop:Q.y*L+"px"})}function p(){if(E)S[0].y<0?N.y=z-1:S[0].y>=z?N.y=0:S[0].x<0?N.x=_-1:S[0].x>=_&&(N.x=0);else if(N.y<0||N.y>=z||N.x<0||N.x>=_)return void d();for(var e=4;I>e;++e)if(N.equals(S[e]))return void d();N.equals(Q)&&v()}function h(){for(var t=!1;!t&&T.length>0;){var n=f[r.indexOf(D)];T[0]==n?T.shift():t=!0}if(T.length>0)switch(D=T.shift(),e(".piece-0").removeClass("left right up down"),D){case a:e(".piece-0").addClass("up");break;case o:e(".piece-0").addClass("down");break;case i:e(".piece-0").addClass("left");break;case s:e(".piece-0").addClass("right")}}function y(){if("play"==A){switch(D){case a:S.unshift(new t(N.x,N.y-1));break;case o:S.unshift(new t(N.x,N.y+1));break;case i:S.unshift(new t(N.x-1,N.y));break;case s:S.unshift(new t(N.x+1,N.y))}S.pop(),N=S[0]}}function v(){x(1),g(j+1),u(),G&&m()}function x(n){for(var a=0;n>a;++a)e(".player",H).append("<div class='square piece-"+I+"'> </div>"),e(".piece-"+I,H).css({position:"absolute",width:O,height:L}),S.push(new t(N.x,N.y)),I++}function g(t){j=t,e(".score",H).html("Score = "+j)}function b(){h(),y(),p(),"play"==A&&w()}function w(){for(var t=0;I>t;++t){var n=k(t);e(".piece-"+t,H).css({marginLeft:n.x+"px",marginTop:n.y+"px"})}}function k(e){return new t(S[e].x*O,S[e].y*L)}function m(){var e="rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")";H.css("background-color",e)}function C(){e("button",H).blur(),"play"==A?(A="pause",e(".settings",H).css("display","block")):(A="play",e(".settings",H).css("display","none"))}function M(t){switch(B=t,(B>2||0>B)&&(B=0),B){case 0:F=100,e(".buttonDiff",H).html("Changer difficulté : Facile");break;case 1:F=50,e(".buttonDiff",H).html("Changer difficulté : Normal");break;case 2:F=25,e(".buttonDiff",H).html("Changer difficulté : Difficile")}"undefined"!=typeof q&&clearInterval(q),q=setInterval(b,F)}var I,D,q,_=parseInt(l.cols),z=parseInt(l.rows),O=l.width/_,L=l.height/z,S=[],T=[],j=0,F=50,N=new t,Q=new t,A="pause",B=0,E=l.warp,G=l.rand_bg,H=e(this);H.addClass("snake").width(l.width).height(l.height).empty().append("<div class='player'> </div>").append("<div class='score'> Score = "+j+" </div>").append("<div class='settings'> </div>").append("<div class='fruit'> <div/>"),e(".fruit",H).css({position:"absolute",width:O,height:L}),e(".score",H).css({"float":"left"}),e(".settings",H).empty().append("<button class='button buttonDiff'> </button> <br>").css({"float":"right"}),M(l.diff),d(),e(document).keydown(function(e){return e.keyCode==c?void d():(e.keyCode==n&&C(),-1!=r.indexOf(e.keyCode)&&("pause"==A&&C(),"play"==A&&T.push(e.keyCode)),e.keyCode==n||-1!=r.indexOf(e.keyCode)?!1:void 0)}),e(".buttonDiff",H).click(function(){M(B+1)})})}}(jQuery);